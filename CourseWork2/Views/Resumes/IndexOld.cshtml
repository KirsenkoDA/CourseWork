@model IEnumerable<EmploymentAgency.Models.Resume>
@using Microsoft.AspNetCore.Identity
@{
    ViewData["Title"] = "Список";
}
@{
    int filteredValue;
}
    @if (ViewData["filteredValues"] == null)
    {
        filteredValue = 0;
        <h1>Список резюме</h1>
    }
    else
    {
        filteredValue = 1;
        <h1>Мои резюме</h1>
    }

@if (filteredValue == 1)
{
    <p>
        <button type="button" class="btn btn-success"><a class="text-white" asp-action="Create">Создать резюме</a></button>
    </p>
}
<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.User)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.DateCreated)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Post)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Info)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Education)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Salary)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.User.UserName)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.DateCreated)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Post)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Info)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Education.Name)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Salary)
            </td>
            <td>
                    @{
                        int statusColour = Convert.ToInt32(item.Status.Id);
                    }
                    @if (User.IsInRole("MODERATOR"))
                    {
                        if (statusColour == 1)
                        {
                            <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve" weight="32" height="32"><path style="fill:#FD3C65;" d="M256,10c132.55,0,246,113.45,246,246S388.55,502,256,502S10,388.55,10,256S123.45,10,256,10z" /><path style="fill:#FFFFFF;" d="M347.21,164.79c11.72,11.71,11.72,30.71,0,42.42L298.42,256l48.79,48.79 c11.72,11.71,11.72,30.71,0,42.42c-5.86,5.86-13.53,8.79-21.21,8.79s-15.35-2.93-21.21-8.79L256,298.42l-48.79,48.79 c-5.86,5.86-13.53,8.79-21.21,8.79s-15.35-2.93-21.21-8.79c-11.72-11.71-11.72-30.71,0-42.42L213.58,256l-48.79-48.79 c-11.72-11.71-11.72-30.71,0-42.42c11.72-11.72,30.7-11.72,42.42,0L256,213.58l48.79-48.79 C316.51,153.07,335.49,153.07,347.21,164.79z" /><path d="M491.375,157.662c-13.15-30.297-31.856-57.697-55.598-81.439s-51.142-42.448-81.439-55.598C322.809,6.939,289.723,0,256,0 s-66.809,6.939-98.338,20.625c-30.297,13.15-57.697,31.856-81.439,55.598s-42.448,51.142-55.598,81.439 C6.939,189.191,0,222.277,0,256s6.939,66.809,20.625,98.338c13.15,30.297,31.856,57.697,55.598,81.439s51.142,42.448,81.439,55.598 C189.191,505.061,222.277,512,256,512s66.809-6.939,98.338-20.625c30.297-13.15,57.697-31.856,81.439-55.598 s42.448-51.142,55.598-81.439C505.061,322.809,512,289.723,512,256S505.061,189.191,491.375,157.662z M256,492 C128.075,492,20,383.925,20,256S128.075,20,256,20s236,108.075,236,236S383.925,492,256,492z" /><path d="M451.975,173.804c-10.87-25.256-26.363-48.044-46.049-67.729c-19.686-19.686-42.473-35.179-67.729-46.049 C311.948,48.728,284.293,43,256,43c-38.462,0-78.555,13.134-115.945,37.981c-4.6,3.057-5.851,9.264-2.794,13.863 c3.057,4.6,9.265,5.85,13.863,2.794C185.224,74.978,221.489,63,256,63c104.617,0,193,88.383,193,193s-88.383,193-193,193 S63,360.617,63,256c0-34.504,11.975-70.771,34.629-104.877c3.056-4.601,1.804-10.807-2.796-13.863 c-4.602-3.056-10.808-1.803-13.863,2.797C56.13,177.454,43,217.546,43,256c0,28.293,5.728,55.948,17.025,82.196 c10.87,25.256,26.363,48.044,46.049,67.729c19.686,19.686,42.473,35.179,67.729,46.049C200.052,463.272,227.707,469,256,469 s55.948-5.728,82.196-17.025c25.256-10.87,48.044-26.363,67.729-46.049c19.686-19.686,35.179-42.473,46.049-67.729 C463.272,311.948,469,284.293,469,256S463.272,200.052,451.975,173.804z" /><path d="M114,105c-5.52,0-10,4.48-10,10s4.48,10,10,10s10-4.48,10-10S119.52,105,114,105z" /><path d="M146,326c0,10.687,4.163,20.731,11.719,28.281C165.276,361.838,175.32,366,186,366s20.724-4.162,28.281-11.719L256,312.562 l41.719,41.719C305.276,361.838,315.32,366,326,366s20.724-4.162,28.278-11.716C361.837,346.731,366,336.687,366,326 s-4.163-20.731-11.719-28.281L312.562,256l41.716-41.716C361.837,206.731,366,196.687,366,186s-4.163-20.731-11.719-28.281 C346.724,150.162,336.681,146,326,146s-20.724,4.162-28.281,11.719L256,199.438l-41.719-41.719C206.724,150.162,196.681,146,186,146 s-20.724,4.162-28.278,11.716C150.163,165.269,146,175.313,146,186s4.163,20.731,11.719,28.281L199.438,256l-41.716,41.716 C150.163,305.269,146,315.313,146,326z M171.861,311.861l48.79-48.79c3.905-3.905,3.905-10.237,0-14.142l-48.793-48.793 C168.081,196.361,166,191.341,166,186s2.081-10.361,5.861-14.139c3.78-3.779,8.801-5.861,14.139-5.861s10.359,2.082,14.139,5.861 l48.79,48.79c3.905,3.905,10.237,3.905,14.143,0l48.79-48.791c3.779-3.778,8.8-5.86,14.138-5.86s10.359,2.082,14.142,5.864 C343.919,175.639,346,180.659,346,186s-2.081,10.361-5.861,14.139l-48.79,48.791c-3.905,3.905-3.905,10.237,0,14.142l48.793,48.793 C343.919,315.639,346,320.659,346,326s-2.081,10.361-5.861,14.139C336.359,343.918,331.338,346,326,346s-10.359-2.082-14.139-5.861 l-48.79-48.79c-1.953-1.953-4.512-2.929-7.071-2.929s-5.119,0.976-7.071,2.929l-48.79,48.79C196.359,343.918,191.338,346,186,346 s-10.359-2.082-14.142-5.864C168.081,336.361,166,331.341,166,326S168.081,315.639,171.861,311.861z" /></svg>
                            <button class="btn btn-success"><a class="text-white" asp-action="Publish" asp-route-id="@item.Id">Опубликовать</a></button>
                        }
                        else
                        {
                            <svg viewBox="0 0 512.00005 512" xmlns="http://www.w3.org/2000/svg" weight="32" height="32"><path d="m502.003906 256c0 135.863281-110.140625 246.003906-246.003906 246.003906s-246-110.140625-246-246.003906 110.136719-246 246-246 246.003906 110.136719 246.003906 246zm0 0" fill="#cbe558" /><path d="m341.667969 139.847656-119.167969 119.167969-52.164062-52.164063-56.570313 56.570313 52.164063 52.164063 56.570312 56.566406 175.734375-175.734375zm0 0" fill="#fff" /><path d="m222.5 382.152344c-2.652344 0-5.195312-1.054688-7.070312-2.929688l-108.734376-108.730468c-3.90625-3.90625-3.90625-10.238282 0-14.144532l56.566407-56.566406c3.90625-3.90625 10.238281-3.90625 14.144531 0l45.09375 45.09375 112.09375-112.097656c1.875-1.875 4.421875-2.929688 7.074219-2.929688 2.648437 0 5.195312 1.054688 7.070312 2.929688l56.566407 56.570312c3.90625 3.902344 3.90625 10.234375 0 14.140625l-175.734376 175.738281c-1.875 1.875-4.417968 2.925782-7.070312 2.925782zm-94.589844-118.730469 94.589844 94.589844 161.59375-161.59375-42.425781-42.429688-112.097657 112.097657c-3.90625 3.90625-10.238281 3.90625-14.140624 0l-45.09375-45.09375zm0 0" /><path d="m255.9375 512c-6.53125 0-13.070312-.25-19.621094-.75-60.835937-4.664062-118.132812-31.027344-161.335937-74.226562-48.351563-48.355469-74.980469-112.640626-74.980469-181.023438 0-68.378906 26.628906-132.667969 74.980469-181.019531 48.351562-48.351563 112.640625-74.980469 181.019531-74.980469 68.382812 0 132.667969 26.628906 181.023438 74.980469 43.199218 43.203125 69.5625 100.5 74.226562 161.335937 4.613281 60.175782-12.144531 120.15625-47.183594 168.898438-3.222656 4.484375-9.472656 5.503906-13.957031 2.28125s-5.503906-9.472656-2.28125-13.957032c67.726563-94.207031 57.234375-222.230468-24.949219-304.417968-92.015625-92.015625-241.738281-92.015625-333.753906 0-92.019531 92.019531-92.019531 241.738281 0 333.757812 82.183594 82.179688 210.210938 92.675782 304.417969 24.945313 4.484375-3.222657 10.730469-2.199219 13.957031 2.285156 3.222656 4.484375 2.199219 10.730469-2.285156 13.957031-43.4375 31.226563-95.804688 47.933594-149.277344 47.933594zm0 0" /><path d="m429.953125 439.953125c-2.632813 0-5.210937-1.070313-7.070313-2.929687-1.859374-1.863282-2.929687-4.441407-2.929687-7.070313 0-2.632813 1.070313-5.210937 2.929687-7.070313 1.859376-1.859374 4.4375-2.929687 7.070313-2.929687 2.628906 0 5.207031 1.070313 7.070313 2.929687 1.859374 1.859376 2.929687 4.4375 2.929687 7.070313 0 2.628906-1.070313 5.207031-2.929687 7.070313-1.863282 1.859374-4.441407 2.929687-7.070313 2.929687zm0 0" /></svg>
                        }
                    }
                    @inject UserManager<IdentityUser> UserManager
                    @{
                        var currentUser = await UserManager.GetUserAsync(User);
                        var currentUserId = currentUser.Id;
                    }
                    @if (User.IsInRole("CLIENT"))
                    {
                        //Если резюме принадлежат пользователю, то он может их изменять и удалять
                        if (item.User.Id == currentUserId)
                        {
                            <a class="text-white" asp-action="Edit" asp-route-id="@item.Id"><button type="button" class="btn btn-primary">Изменить</button></a>
                            <a class ="text-white" asp-action="Delete" asp-route-id="@item.Id"><button type="button" class="btn btn-danger">Удалить</button></a>
                        }
                        //Если резюме принадлежит пользователю, то он не может откликаться
                        else
                        {   @*Если пользователь откликнулся, то он уже откликатьс не может*@
                            if (item.Responds.FirstOrDefault(e => e.User.Id == currentUserId) != null)
                            {
                                <a class="text-white" asp-action="Respond" asp-route-id="@item.Id"><button type="button" class="btn btn-success">Откликнуться</button></a>
                            }
                        }
                    }
                    <a asp-action="Details" asp-route-id="@item.Id"><button type="button" class="btn btn-warning">Детально</button></a>
            </td>
        </tr>
}
    </tbody>
</table>
